#1. Create a security group with the name nonadmins in AD.
#2. Add a user (or users) to the group

#We start a "normal" remote connection and check how many cmdlets are available
Enter-PSSession -ComputerName dc01

(Get-Command).count

#We navigate in to the following path
Set-Location 'C:\Program Files\WindowsPowerShell\Modules'

#Create a new directory
New-Item -ItemType Directory nonadmins

#Navigate to the directory
Set-Location nonadmins

#Create a new directory
New-Item -ItemType Directory RoleCapabilities

#Navigate to the directory
Set-Location RoleCapabilities

#Creates a file that defines a set of capabilities to be exposed through a session configuration
New-PSRoleCapabilityFile -Path .\nonadmins.psrc

#Now we edit this file
ISE .\nonadmins.psrc

#Creates a file that defines a session configuration
New-PSSessionConfigurationFile .\nonadmins.pssc

#Now we edit this file
ISE .\nonadmins.pssc

#Let us check the settings 
Test-PSSessionConfigurationFile .\nonadmins.pssc

#Creates and registers a new session configuration
Register-PSSessionConfiguration -Name nonadmins -Path .\nonadmins.pssc

#We need to restart the WinRM Service
Restart-Service WinRM

#Gets the registered session configurations on the computer
Get-PSSessionConfiguration

#We establish a connection
Enter-PSSession -ComputerName dc01 -ConfigurationName nonadmins -Credential prime\james.west

#And check the number of cmdlets and the account created for the connection
Get-Command

#Close the Session
Exit-PSSession

#(Optional) Deletes registered session configurations from the computer
Unregister-PSSessionConfiguration -Name Helpdesk
